<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì™¼ì†ì¡ì´ì— ëŒ€í•œ ì˜¤í•´ì™€ ì§„ì‹¤</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700;800&family=IBM+Plex+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        /* ê¸°ë³¸ í°íŠ¸ ì„¤ì • */
        body { font-family: 'Nanum Gothic', sans-serif; }
        /* ì–´íœ˜ ëª©ë¡ ì‚¬ì´ë“œë°” í°íŠ¸ */
        .vocab-sidebar { font-family: 'IBM Plex Sans KR', sans-serif; }
        /* ì–´íœ˜ íŒì—… ìŠ¤íƒ€ì¼ */
        .vocab-popup { font-family: 'Nanum Gothic', sans-serif; z-index: 50; max-width: 320px; white-space: normal; }
        /* í˜¸ë²„ íˆ´íŒ ìŠ¤íƒ€ì¼ */
        .hover-tooltip { position: fixed; z-index: 9999; background: white; border: 2px solid #22c55e; border-radius: 8px; padding: 12px; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); max-width: 320px; font-family: 'Nanum Gothic', sans-serif; animation: fadeIn 0.15s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-5px); } to { opacity: 1; transform: translateY(0); } }
        /* ì¼ë°˜ ì–´íœ˜ ê°•ì¡° ìŠ¤íƒ€ì¼ */
        .highlight-general { font-weight: 600; color: #374151; cursor: pointer; position: relative; transition: background-color 0.2s; }
        /* ë§ˆìš°ìŠ¤ í˜¸ë²„ ë˜ëŠ” í™œì„±í™” ì‹œ ìŠ¤íƒ€ì¼ */
        .highlight-general:hover, .active-highlight { background-color: #dcfce7; border-radius: 3px; }
        .script-highlight { background-color: #e0f2fe; border-radius: 8px; }
        .vocab-highlight { background-color: #dcfce7; border: 2px solid #22c55e; border-radius: 8px; }

        /* --- ë§í’ì„  ìŠ¤íƒ€ì¼ --- */
        /* Updated tail styles to match new class names */
        .bubble-tail-left.bubble-kkn20::after { /* Yuna Style 1 */
            content: "";
            position: absolute;
            bottom: 6px;
            left: -8px;
            width: 0px;
            height: 0px;
            border-top: 8px solid transparent;
            border-bottom: 8px solid transparent;
            border-right: 8px solid #dcfce7; /* green-100 */
            transition: border-color 0.3s;
        }
        /* Add style for Yuna Style 2 if needed */
        /* .bubble-tail-left.bubble-kkn30::after { ... } */

        .bubble-tail-right.bubble-other::after { /* Woody Style */
            content: "";
            position: absolute;
            bottom: 6px;
            right: -8px;
            width: 0px;
            height: 0px;
            border-top: 8px solid transparent;
            border-bottom: 8px solid transparent;
            border-left: 8px solid white;
            transition: border-color 0.3s;
        }

        /* Active styles targeting new classes */
        .bubble-active.bubble-tail-left.bubble-kkn20::after,
        /* Add active style for Yuna Style 2 if needed */
        /* .bubble-active.bubble-tail-left.bubble-kkn30::after, */
        .bubble-active.bubble-tail-right.bubble-other::after {
            border-right-color: #fef9c3; /* yellow-100 */
            border-left-color: #fef9c3; /* yellow-100 */
        }


        /* --- ë””ë°”ì´ìŠ¤ë³„ ë ˆì´ì•„ì›ƒ ìŠ¤íƒ€ì¼ --- */
        /* These rules are removed as layout is now handled by responsive Tailwind classes in the component */
        
        /* ì¸ì‡„ ì „ìš© ìŠ¤íƒ€ì¼ */
        .print-only { display: none; }
        @media print {
            @page { size: A4; margin: 0.75cm 1cm; }
            .no-print { display: none !important; }
            .print-only { display: inline-block !important; }
            body, html { background: white !important; font-size: 9pt; }
            .mx-auto { max-width: none !important; padding: 0 !important; margin: 0 !important; border: none !important; box-shadow: none !important; }
            body > #root > div { padding: 0 !important; }
            * { box-shadow: none !important; border-color: transparent !important; -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
            p, h1, h2, h3, h4, span, li { color: black !important; }
            p, li { line-height: 1.5; }
            header.text-center { margin-bottom: 1rem !important; }
            .pt-10 { padding-top: 1rem !important; }
            .mb-8 { margin-bottom: 0.4pt !important; }
            h1, h2 { font-size: 12pt !important; margin-bottom: 15px; }
            h3 { font-size: 12pt !important; margin-bottom: 10px; }
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>
    <script type="text/babel">
        /**
         * @typedef {Object} ScriptLine
         * @property {string} id - Unique identifier (e.g., 's1')
         * @property {string} speaker - Speaker name ('ìœ ë‚˜' | 'ìš°ë””')
         * @property {string} kor - Korean text
         * @property {string} eng - English translation
         * @property {[number, number]} [time] - Optional [start, end] timestamps
         */

        // --- ì•„ì´ì½˜ ì»´í¬ë„ŒíŠ¸ ---
        const Icon = React.memo(({ children, className = 'w-6 h-6' }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>);
        const Video = ({ className }) => <Icon className={className}><path d="m22 8-6 4 6 4V8Z"></path><rect width="14" height="12" x="2" y="6" rx="2" ry="2"></rect></Icon>;
        const BookOpen = ({ className }) => <Icon className={className}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></Icon>;
        const MessageSquare = ({ className }) => <Icon className={className}><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></Icon>;
        const ThumbsUp = ({ className }) => <Icon className={className}><path d="M7 10v12"></path><path d="M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2h0a2 2 0 0 1 3 1.88V5Z"></path></Icon>;
        const List = ({ className }) => <Icon className={className}><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></Icon>;
        const Spinner = ({ className = 'w-5 h-5' }) => (
            <svg className={`animate-spin ${className}`} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
        );

        // --- ê³µìš© ì»´í¬ë„ŒíŠ¸: ë²ˆì—­ ë²„íŠ¼ ---
        const TranslateButton = React.memo(({ textToTranslate }) => {
            const { useState, useEffect, useRef, useCallback } = React;
            const [translation, setTranslation] = useState(null);
            const [isLoading, setIsLoading] = useState(false);
            const [error, setError] = useState(null);
            const [show, setShow] = useState(false);
            const [buttonLang, setButtonLang] = useState('Translation');
            const isMounted = useRef(true);

            useEffect(() => {
                isMounted.current = true;
                setButtonLang('Translation'); // ë²„íŠ¼ í…ìŠ¤íŠ¸ 'Translation'ìœ¼ë¡œ ì„¤ì •
                return () => { isMounted.current = false; };
            }, []);

            const handleTranslate = useCallback(async () => {
                if (show) { setShow(false); return; }
                if (translation) { setShow(true); return; }
                if (!textToTranslate.trim()) return;

                setIsLoading(true);
                setError(null);
                try {
                    const targetLanguage = 'English';
                    const prompt = `Translate the following Korean text to ${targetLanguage}. Provide only the most natural-sounding translation, without any additional explanations or quotation marks.`;
                    const payload = { contents: [{ role: "user", parts: [{ text: prompt }, { text: textToTranslate }] }] };
                    // NOTE: The API key is intentionally left blank.
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=`, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                    if (!response.ok) throw new Error(`API Error: ${response.status}`);
                    const result = await response.json();
                    if (isMounted.current && result.candidates?.[0]?.content.parts[0].text) {
                        setTranslation(result.candidates[0].content.parts[0].text.trim());
                        setShow(true);
                    } else { throw new Error("Invalid API response format."); }
                } catch (err) { if (isMounted.current) setError("ë²ˆì—­ì— ì‹¤íŒ¨í–ˆì–´ìš”."); }
                finally { if (isMounted.current) setIsLoading(false); }
            }, [show, translation, textToTranslate]);

            return (
                <div className="no-print flex flex-col items-start"> {/* flex-colë¡œ ë³€ê²½í•˜ì—¬ ë²ˆì—­ í…ìŠ¤íŠ¸ê°€ ë²„íŠ¼ ì•„ë˜ì— ì˜¤ë„ë¡ í•¨ */}
                    <button onClick={handleTranslate} disabled={isLoading} className="text-xs text-gray-500 hover:text-gray-800 py-1 px-2 bg-gray-100 hover:bg-gray-200 rounded-md transition-colors disabled:text-gray-300">{isLoading ? 'Translating...' : (show ? 'Hide' : buttonLang)}</button> {/* font-semibold ì œê±° ë° í…ìŠ¤íŠ¸ ë³€ê²½ */}
                    {show && translation && <p className="text-gray-600 text-base mt-2 mb-2 whitespace-pre-wrap">{translation}</p>}
                    {error && <p className="text-red-500 text-sm mt-1">{error}</p>}
                </div>
            );
        });

        // --- [ë™ì˜ìƒ ìë£Œ] íƒ­ ê´€ë ¨ ì»´í¬ë„ŒíŠ¸ ---
        const HighlightedText = React.memo(({ text, highlightData, onWordHover, onWordLeave, lineId, activeWordId }) => {
            if (!text || !highlightData) return text;
            const { regex, wordMap, sortedWords } = highlightData;
            const parts = text.split(regex);
            return (<>{parts.map((part, index) => {
                if (!part) return null;
                if (index % 2 === 0) return part;
                const trimmedPart = part.trim();
                const baseForm = sortedWords.find(word => {
                    const vocabItem = wordMap.get(word);
                    if (vocabItem.variants && vocabItem.variants.includes(trimmedPart)) return true;
                    const cleanPart = trimmedPart.replace(/\s/g, '');
                    const cleanWord = word.replace(/\s/g, '');
                    if (word.endsWith('ë‹¤')) return cleanPart.startsWith(cleanWord.slice(0, -1));
                    return cleanPart.startsWith(cleanWord);
                });
                if (!baseForm) return part;
                const info = wordMap.get(baseForm);
                if (!info) return part;
                const uniqueWordId = `${lineId}-${index}-${baseForm}`;
                const classes = ['highlight-general', 'font-bold', activeWordId === uniqueWordId ? 'active-highlight' : ''].join(' ');
                return <span
                    key={index}
                    className={classes}
                    onMouseEnter={(e) => onWordHover(e, baseForm, lineId, index)}
                    onMouseLeave={onWordLeave}
                >{part}</span>;
            })}</>);
        });

        const HoverTooltip = React.memo(({ data, position }) => {
            if (!data || !position) return null;
            return (
                <div
                    className="hover-tooltip"
                    style={{ left: `${position.x}px`, top: `${position.y}px` }}
                >
                    <p className="font-bold text-lg text-green-700 mb-2">{data.term}</p>
                    <p className="text-gray-700 text-base">{data.mainDef}</p>
                    {data.subDefs && data.subDefs.length > 0 && (
                        <div className="mt-3 pt-3 border-t border-gray-200">
                            <ul className="space-y-1">
                                {data.subDefs.map((sub, i) => (
                                    <li key={i} className="text-sm">
                                        <span className="font-semibold text-gray-600">{sub.subTerm}:</span>{' '}
                                        <span className="text-gray-600">{sub.subDef}</span>
                                    </li>
                                ))}
                            </ul>
                        </div>
                    )}
                </div>
            );
        });

        const VocabItem = React.memo(React.forwardRef(({ item, isHighlighted }, ref) => {
            const { useState } = React;
            const [showExamples, setShowExamples] = useState(false);

            return (
                <div ref={ref} className={`p-4 rounded-lg border-b ${isHighlighted ? 'vocab-highlight' : 'bg-white'}`}>
                    <p className="font-bold text-lg text-green-700">{item.term}</p>
                    <div className="pl-4 mt-2 border-l-2">
                        <p className="text-gray-700">{item.mainDef}</p>
                        {item.subDefs && item.subDefs.length > 0 && (
                            <div className="mt-3 pt-3 border-t">{item.subDefs.map((sub, index) => (
                                <div key={index} className="text-sm mt-2">
                                    <p className="font-semibold">{sub.subTerm}</p>
                                    <p className="text-gray-600 pl-2">{sub.subDef}</p>
                                </div>
                            ))}</div>
                        )}
                    </div>
                    {item.examples && item.examples.length > 0 && (
                        <div className="mt-3 no-print">
                            <button onClick={() => setShowExamples(!showExamples)} className="text-xs bg-green-200 hover:bg-green-300 text-gray-600 py-1 px-2 rounded-md">
                                {showExamples ? 'Close Examples' : 'Sentence Examples'}
                            </button>
                            {showExamples && (
                                <div className="mt-3 p-3 bg-green-50 rounded-lg space-y-3 text-sm">
                                    {item.examples.map((ex, index) => (
                                        <div key={index}>
                                            <p className="font-medium text-gray-800">{ex.kor}</p>
                                            <p className="text-gray-400 hover:text-gray-700 transition-colors">{ex.eng}</p>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    )}
                </div>
            );
        }));

        const VideoMaterialsTab = ({scriptContent, vocabAndGrammarList, highlightData, vocabMap}) => {
            const { useState, useRef, useEffect, useCallback, useMemo } = React;
            const [activeWordId, setActiveWordId] = useState(null);
            const [player, setPlayer] = useState(null);
            const [activeScriptLine, setActiveScriptLine] = useState(null);
            const [isSyncEnabled, setIsSyncEnabled] = useState(true);
            const [repeatingLine, setRepeatingLine] = useState(null);
            const [hoverPopupData, setHoverPopupData] = useState(null);
            const [highlightedVocab, setHighlightedVocab] = useState(null);
            const [translationsVisible, setTranslationsVisible] = useState({});
            const [playerHeight, setPlayerHeight] = useState(0);
            const [isVocabSidebarVisible, setIsVocabSidebarVisible] = useState(true);
            const [isPortrait, setIsPortrait] = useState(window.matchMedia("(orientation: portrait)").matches);

            const scriptLineRefs = useRef({});
            const vocabRefs = useRef({});
            const intervalRef = useRef();
            const playerContainerRef = useRef(null);
            const scriptWrapperRef = useRef(null); // ìŠ¤í¬ë¡¤ ì»¨í…Œì´ë„ˆë¥¼ ìœ„í•œ ref ì¶”ê°€
            const hoverTimeoutRef = useRef(null);

            const activeScriptLineRef = useRef(activeScriptLine);
            activeScriptLineRef.current = activeScriptLine;

            // --- Phase 2: Indexing for performance ---
            const timeIndex = useMemo(() => {
                return scriptContent
                    .filter(line => line.time)
                    .map(line => ({ start: line.time[0], end: line.time[1], id: line.id }))
                    .sort((a, b) => a.start - b.start);
            }, [scriptContent]);

            const onPlayerReady = useCallback((event) => setPlayer(event.target), []);

            const setupPlayer = useCallback(() => {
                if (window.YT && window.YT.Player) {
                    const newPlayer = new window.YT.Player('youtube-player', {
                        height: '100%',
                        width: '100%',
                        videoId: 'or55JENlG2k',
                        events: { 'onReady': onPlayerReady }
                    });
                    setPlayer(newPlayer);
                }
            }, [onPlayerReady]);

            useEffect(() => {
                const mediaQuery = window.matchMedia("(orientation: portrait)");
                const handleOrientationChange = (e) => setIsPortrait(e.matches);
                mediaQuery.addEventListener('change', handleOrientationChange);
                return () => mediaQuery.removeEventListener('change', handleOrientationChange);
            }, []);

            useEffect(() => {
                if (window.YT && document.getElementById('youtube-player')) {
                    if (!player) setupPlayer();
                } else if (!window.YT) {
                    window.onYouTubeIframeAPIReady = setupPlayer;
                }
                return () => { if (intervalRef.current) clearInterval(intervalRef.current); };
            }, [setupPlayer, player]);

            useEffect(() => {
                let ro;
                if (playerContainerRef.current) {
                    const updateHeight = () => { if (playerContainerRef.current) setPlayerHeight(playerContainerRef.current.offsetHeight); };
                    ro = new ResizeObserver(updateHeight);
                    ro.observe(playerContainerRef.current);
                    updateHeight();
                }
                return () => ro?.disconnect();
            }, []);

            useEffect(() => {
                if (player && isSyncEnabled && !repeatingLine) {
                    intervalRef.current = setInterval(() => {
                        if (player.getCurrentTime) {
                            const currentTime = player.getCurrentTime();
                            const currentLine = timeIndex.find(line => currentTime >= line.start && currentTime < line.end);
                            const currentLineId = currentLine ? currentLine.id : null;
                            if (activeScriptLineRef.current !== currentLineId) {
                                setActiveScriptLine(currentLineId);
                            }
                        }
                    }, 250);
                } else {
                    clearInterval(intervalRef.current);
                }
                return () => clearInterval(intervalRef.current);
            }, [player, isSyncEnabled, repeatingLine, timeIndex]);

            useEffect(() => {
                if (activeScriptLine && isSyncEnabled) {
                    const lineElement = scriptLineRefs.current[activeScriptLine];
                    
                    // --- ìˆ˜ì •ëœ ìŠ¤í¬ë¡¤ ë¡œì§ ---
                    if (lineElement && scriptWrapperRef.current) {
                        // scrollIntoViewë¥¼ ì‚¬ìš©í•˜ì—¬ ìš”ì†Œë¥¼ ë¶€ë“œëŸ½ê²Œ ì¤‘ì•™ìœ¼ë¡œ ìŠ¤í¬ë¡¤í•©ë‹ˆë‹¤.
                        // 'block: 'center'' ì˜µì…˜ì´ ìš”ì†Œë¥¼ ìŠ¤í¬ë¡¤ ì»¨í…Œì´ë„ˆì˜ ì¤‘ì•™ì— ìœ„ì¹˜ì‹œí‚µë‹ˆë‹¤.
                        // ìŠ¤í¬ë¡¤ ì»¨í…Œì´ë„ˆê°€ ë§¨ ìœ„ë‚˜ ë§¨ ì•„ë˜ì— ë„ë‹¬í•˜ë©´,
                        // ë¸Œë¼ìš°ì €ê°€ ìë™ìœ¼ë¡œ ìŠ¤í¬ë¡¤ì„ ë©ˆì¶¥ë‹ˆë‹¤.
                        lineElement.scrollIntoView({
                            behavior: 'smooth',
                            block: 'center'
                        });
                    }
                    // --- ì´ì „ ë¡œì§ ì‚­ì œ ---
                }
            }, [activeScriptLine, isSyncEnabled]); // ì˜ì¡´ì„± ë°°ì—´ì€ ì •í™•í•©ë‹ˆë‹¤.

            useEffect(() => {
                if (repeatingLine && player && player.seekTo) {
                    const [start, end] = repeatingLine.time;
                    player.seekTo(start);
                    if(player.playVideo) player.playVideo();
                    intervalRef.current = setInterval(() => {
                        if (player.getCurrentTime && player.getCurrentTime() >= end) {
                            player.seekTo(start);
                        }
                    }, 200);
                }
                return () => clearInterval(intervalRef.current);
            }, [repeatingLine, player]);

            const handleRepeatClick = (line) => {
                setRepeatingLine(prev => (prev && prev.id === line.id) ? null : line);
            };

            const handleWordHover = useCallback((e, baseForm) => {
                e.stopPropagation();
                if (hoverTimeoutRef.current) clearTimeout(hoverTimeoutRef.current);

                const wordData = vocabMap.get(baseForm);
                if (wordData) {
                    const rect = e.target.getBoundingClientRect();
                    let x = rect.left;
                    let y = rect.bottom + 5;
                    const tooltipWidth = 320;
                    if (x + tooltipWidth > window.innerWidth) {
                        x = rect.right - tooltipWidth;
                        if (x < 0) x = 10;
                    }
                    const tooltipHeight = 200; // Approximate height
                    if (y + tooltipHeight > window.innerHeight + window.scrollY) {
                        y = rect.top - tooltipHeight - 5;
                    }
                    setHoverPopupData({ data: wordData, position: { x, y } });
                    setHighlightedVocab(wordData.term);

                    const vocabElement = vocabRefs.current[wordData.term];
                    if (vocabElement) {
                        vocabElement.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                    }
                }
            }, [vocabMap]);

            const handleWordLeave = useCallback(() => {
                hoverTimeoutRef.current = setTimeout(() => {
                    setHoverPopupData(null);
                    setHighlightedVocab(null);
                }, 200);
            }, []);

            const toggleTranslation = (lineId) => {
                setTranslationsVisible(prev => ({ ...prev, [lineId]: !prev[lineId] }));
            };

            return (
                <div className="video-materials-content md:flex md:flex-row md:gap-6">
                    {hoverPopupData && <HoverTooltip data={hoverPopupData.data} position={hoverPopupData.position} />}
                    <div ref={playerContainerRef} className="video-wrapper md:w-2/5 md:sticky top-0 z-40 bg-gray-50 py-4 no-print">
                        <div className={`w-full rounded-xl shadow-lg border-4 border-white overflow-hidden transition-all duration-300 ease-in-out aspect-[9/16]`}>
                            <div id="youtube-player" className="w-full h-full"></div>
                        </div>
                        <div className="mt-4 flex justify-start">
                            <label htmlFor="sync-toggle" className="flex-1 flex items-center justify-between cursor-pointer bg-white py-1.5 px-3 rounded-lg shadow-md border max-w-xs">
                                <span className="text-xs font-medium text-gray-900 whitespace-nowrap">Auto-scroll</span>
                                <div className="relative">
                                    <input type="checkbox" id="sync-toggle" className="sr-only" checked={isSyncEnabled} onChange={() => setIsSyncEnabled(!isSyncEnabled)} />
                                    <div className={`block w-10 rounded-full transition-colors ${isSyncEnabled ? 'bg-green-500' : 'bg-gray-200'}`} style={{ height: '0.35cm' }}></div>
                                    <div className={`dot absolute left-1 top-[2.6px] bg-white w-2 h-2 rounded-full transition-transform ${isSyncEnabled ? 'transform translate-x-6' : ''}`}></div>
                                </div>
                            </label>
                        </div>
                    </div>
                    <div ref={scriptWrapperRef} className="script-wrapper md:w-3/5 md:max-h-[calc(100vh-4rem)] md:overflow-y-auto"> {/* ì—¬ê¸°ì— ref ì¶”ê°€ */}
                        <main className="flex-grow">
                            <div className="space-y-6">
                                {scriptContent.map(line => {
                                    const hasTranslation = !!line.eng;
                                    const isActive = activeScriptLine === line.id;

                                    if (line.kor.startsWith('â€¢')) {
                                        return (
                                            <div key={line.id} ref={el => scriptLineRefs.current[line.id] = el}
                                                className={`p-3 my-2 rounded-lg transition-colors duration-300 ${isActive ? 'bg-yellow-100' : ''}`}>
                                                <p className="whitespace-pre-wrap text-lg text-gray-800">
                                                    <HighlightedText text={line.kor} highlightData={highlightData} onWordHover={handleWordHover} onWordLeave={handleWordLeave} lineId={line.id} activeWordId={activeWordId} />
                                                </p>
                                                {/* Translation text is now handled by TranslateButton */}
                                                <div className="mt-2 no-print">
                                                    <TranslateButton textToTranslate={line.kor} />
                                                </div>
                                            </div>
                                        );
                                    }

                                    const isYuna = line.speaker === 'ìœ ë‚˜';
                                    const bubbleWrapperClasses = `flex flex-col max-w-[100%] sm:max-w-[100%] ${isYuna ? 'items-start' : 'items-end self-end'}`;
                                    const bubbleBaseClasses = 'relative px-5 py-3 rounded-2xl shadow-md transition-colors duration-300';
                                    const yunaBubbleColor = 'bg-green-100';
                                    const woodyBubbleColor = 'bg-white';
                                    const activeBubbleColor = 'bg-yellow-100';
                                    // Determine tailClass based on speaker
                                    const tailClass = isYuna ? 'bubble-tail-left bubble-kkn20' : 'bubble-tail-right bubble-other';
                                    const bubbleClasses = `${bubbleBaseClasses} ${isActive ? activeBubbleColor : (isYuna ? yunaBubbleColor : woodyBubbleColor)} ${tailClass} ${isActive ? 'bubble-active' : ''}`;
                                    const speakerNameClasses = `font-bold mb-1 ${isYuna ? 'text-green-800' : 'text-blue-800'}`;

                                    return (
                                        <div key={line.id} ref={el => scriptLineRefs.current[line.id] = el} className="flex flex-col w-full">
                                            <div className={bubbleWrapperClasses}>
                                                <p className={`${speakerNameClasses} ${isYuna ? 'self-start' : 'self-end'}`}>{line.speaker}</p>
                                                <div className={bubbleClasses}>
                                                    <p className="whitespace-pre-wrap text-lg text-gray-800">
                                                        <HighlightedText text={line.kor} highlightData={highlightData} onWordHover={handleWordHover} onWordLeave={handleWordLeave} lineId={line.id} activeWordId={activeWordId} />
                                                    </p>
                                                </div>
                                                <div className={`w-full flex flex-col ${isYuna ? 'items-start' : 'items-end'}`}>
                                                    {/* Translation text is now handled by TranslateButton */}
                                                    <div className="flex items-start gap-2 mt-2 px-2 no-print"> {/* items-startë¡œ ë³€ê²½í•˜ì—¬ ë²„íŠ¼ ìƒë‹¨ ì •ë ¬ */}
                                                        {line.time && (
                                                            <button onClick={() => handleRepeatClick(line)} className={`text-xs px-2 py-1 rounded-md transition ${repeatingLine?.id === line.id ? 'bg-red-200 hover:bg-red-300 text-red-800' : 'bg-gray-100 hover:bg-gray-200 text-gray-800'}`}>
                                                                {repeatingLine?.id === line.id ? 'Stop loop' : 'Loop playback'}
                                                            </button>
                                                        )}
                                                        <TranslateButton textToTranslate={line.kor} /> {/* Translation ë²„íŠ¼ì„ ì´ê³³ìœ¼ë¡œ ì´ë™ */}
                                                    </div>
                                                    <div className="px-2 w-full">
                                                        {/* TranslateButtonì´ ìœ„ë¡œ ì´ë™í–ˆìŠµë‹ˆë‹¤. */}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        </main>
                        {/* REMOVED: The <aside className="vocab-sidebar ..."> block 
                             which contained the vocabulary list and toggle buttons 
                             has been completely removed from this component.
                        */}
                    </div>
                </div>
            )
        }

        // --- [í€´ì¦ˆ&í† ë¡ ] íƒ­ ê´€ë ¨ ì»´í¬ë„ŒíŠ¸ ---
        const ComprehensionQuiz = ({ sentences }) => {
            const { useState, useMemo } = React;
            const [selectedWords, setSelectedWords] = useState({});
            const [results, setResults] = useState({});
            const [translationsVisible, setTranslationsVisible] = useState({});
            const [hintsVisible, setHintsVisible] = useState({});

            const shuffledSentences = useMemo(() => {
                const shuffleArray = (array) => {
                    const newArray = [...array];
                    for (let i = newArray.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
                    }
                    return newArray;
                };
                return sentences.map(sentence => ({ ...sentence, bank: shuffleArray(sentence.bank) }));
            }, [sentences]);

            const handleWordSelect = (id, word) => {
                setSelectedWords(prev => ({...prev, [id]: word}));
                const isCorrect = sentences.find(s => s.id === id).answer === word;
                setResults(prev => ({...prev, [id]: isCorrect}));
                setHintsVisible(prev => ({ ...prev, [id]: false }));
            };
            const handleToggleTranslation = (id) => { setTranslationsVisible(prev => ({...prev, [id]: !prev[id]})); };
            const handleToggleHint = (id) => { if (results[id] !== true) setHintsVisible(prev => ({...prev, [id]: !prev[id]})); };

            return (
                <div className="space-y-8">
                    {shuffledSentences.map((s, index) => (
                        <div key={s.id} className="p-6 border rounded-xl bg-white shadow-lg transition-all duration-300">
                            <p className="text-gray-700 font-bold text-lg mb-4">{index + 1}. ë‹¤ìŒ ë¹ˆì¹¸ì— ì•Œë§ì€ ë§ì„ ê³ ë¥´ì„¸ìš”. (Choose the correct word for the blank.)</p>
                            <div className="p-4 bg-gray-100 rounded-lg text-left mb-3 text-gray-900 text-xl font-bold">
                                {s.parts[0]}
                                <span className="inline-block bg-yellow-200 text-green-800 px-3 py-1 rounded-md font-extrabold mx-2">
                                    {hintsVisible[s.id] ? `[ ${s.eng_hint} ]` : (selectedWords[s.id] || '___')}
                                </span>
                                {s.parts[1]}
                                {results[s.id] === true && <span className="inline-block ml-2 text-green-500">âœ“</span>}
                                {results[s.id] === false && <span className="inline-block ml-2 text-red-500">âœ—</span>}
                            </div>
                            {translationsVisible[s.id] && (
                                <div className="text-gray-600 italic p-3 bg-gray-50 rounded-lg text-left mt-2 text-base">
                                    {results[s.id] ? (<span>{s.eng_parts[0]}<strong className="text-green-600">{s.eng_answer}</strong>{s.eng_parts[1]}</span>)
                                    : (<span>{s.eng_parts[0]}<span className="font-bold">___</span>{s.eng_parts[1]}</span>)}
                                </div>
                            )}
                            <div className="text-left mb-4 flex gap-2">
                                <button onClick={() => handleToggleHint(s.id)} className="text-xs bg-yellow-200 hover:bg-yellow-300 text-yellow-800 font-bold py-1 px-3 rounded-full transition duration-200 disabled:opacity-50 disabled:cursor-not-allowed" disabled={results[s.id] === true}>íŒíŠ¸ (Hint)</button>
                                <button onClick={() => handleToggleTranslation(s.id)} className="text-xs bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold py-1 px-3 rounded-full transition duration-200">ë²ˆì—­ (Translation)</button>
                            </div>
                            <div className="flex justify-start flex-wrap gap-3">
                                {s.bank.map(word => (
                                    <button
                                        key={word}
                                        onClick={() => handleWordSelect(s.id, word)}
                                        className={`px-4 py-2 rounded-lg text-lg font-bold transition-all transform hover:scale-105 shadow-md ${selectedWords[s.id] === word ? (results[s.id] ? 'bg-green-500 text-white ring-2 ring-opacity-50 ring-green-400' : 'bg-red-500 text-white ring-2 ring-red-300') : 'bg-white text-gray-800 hover:bg-gray-100 border'}`}
                                    >{word}</button>
                                ))}
                            </div>
                            {results[s.id] !== undefined && (
                                <div className={`mt-4 p-4 border-l-4 rounded-r-lg ${results[s.id] ? 'bg-green-50 border-green-400' : 'bg-red-50 border-red-400'}`}>
                                    <p className={`font-bold ${results[s.id] ? 'text-green-800' : 'text-red-800'} flex items-center gap-2 text-lg`}>{results[s.id] ? 'Correct!' : 'Try again.'}</p>
                                    <p className="mt-2 text-gray-700 text-base italic">{results[s.id] ? s.eng_explanation : s.eng_wrongAnswerExplanations[selectedWords[s.id]]}</p>
                                </div>
                            )}
                        </div>
                    ))}
                </div>
            );
        };

        const SentenceChecker = ({ value, onChange, placeholder, question }) => {
            const { useState } = React;
            const [feedback, setFeedback] = useState(null);
            const [isLoading, setIsLoading] = useState(false);
            const [error, setError] = useState(null);

            const checkSentence = async () => {
                if (!value || value.trim() === '') {
                    setError("ë¬¸ì¥ì„ ì…ë ¥í•´ì•¼ í”¼ë“œë°±ì„ ë°›ì„ ìˆ˜ ìˆì–´ìš”.");
                    setFeedback(null); return;
                }
                setIsLoading(true); setError(null); setFeedback(null);
                const prompt = `You are an advanced Korean language tutor AI for B1-C2 level learners. Analyze the user's sentence in response to a specific question. The user's answer is in Korean. Your entire response MUST be a JSON object, with all string values in Korean (ending in -ìš”) and English.\n\nQuestion: "${question}"\nUser's Answer: "${value}"\n\nYour response MUST be a JSON object with the specified schema.`;
                const payload = {
                    contents: [{ role: "user", parts: [{ text: prompt }] }],
                    generationConfig: {
                        responseMimeType: "application/json",
                        responseSchema: { type: "OBJECT", properties: { "is_relevant": { "type": "BOOLEAN" }, "relevance_feedback_kor": { "type": "STRING", "nullable": true }, "relevance_feedback_eng": { "type": "STRING", "nullable": true }, "is_correct": { "type": "BOOLEAN", "nullable": true }, "feedback_message_kor": { "type": "STRING", "nullable": true }, "feedback_message_eng": { "type": "STRING", "nullable": true }, "corrected_sentence": { "type": "STRING", "nullable": true }, "explanation_kor": { "type": "STRING", "nullable": true }, "explanation_eng": { "type": "STRING", "nullable": true }, "alternative_expressions": { "type": "ARRAY", "items": { "type": "OBJECT", "properties": { "expression_kor": { "type": "STRING" }, "expression_eng": { "type": "STRING" } }, "required": ["expression_kor", "expression_eng"] } } }, "required": ["is_relevant"] }
                    }
                };
                const apiKey = ""; // NOTE: The API key is intentionally left blank.
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
                try {
                    const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                    if (!response.ok) throw new Error(`API error: ${response.statusText}`);
                    const result = await response.json();

                    // Enhanced error handling for API response
                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0 && result.candidates[0].content.parts[0].text) {
                        try {
                            const parsedJson = JSON.parse(result.candidates[0].content.parts[0].text);
                            setFeedback(parsedJson);
                        } catch (parseError) {
                            console.error("Error parsing JSON response:", parseError, result.candidates[0].content.parts[0].text);
                            setError("AIì˜ ì‘ë‹µ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•Šì•„ ì²˜ë¦¬í•  ìˆ˜ ì—†ì–´ìš”.");
                        }
                    } else {
                        console.error("Invalid API response structure:", result);
                        setError("AIì˜ ì‘ë‹µì„ ì²˜ë¦¬í•˜ëŠ” ë° ë¬¸ì œê°€ ë°œìƒí–ˆì–´ìš”.");
                    }
                } catch (err) {
                    console.error("Error checking sentence:", err);
                    setError("ë¬¸ì¥ ê²€ì‚¬ì— ì‹¤íŒ¨í–ˆì–´ìš”. ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•˜ê±°ë‚˜ ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.");
                }
                finally { setIsLoading(false); }
            };


            const renderFeedbackSection = (title, content) => (content && content.length > 0 && (
                <div>
                    <p className="text-gray-800 font-bold text-[17px]">{title}</p>
                    {Array.isArray(content) ? (
                        <ul className="list-disc list-inside space-y-2 mt-1">
                            {content.map((item, index) => (
                                <li key={index} className="text-gray-600 text-[16px]">
                                    <p className="font-medium">{item.expression_kor || item.sentence_kor}</p>
                                    <p className="text-gray-500 italic text-sm">{item.expression_eng || item.sentence_eng}</p>
                                </li>
                            ))}
                        </ul>
                    ) : (<p className="text-gray-700 font-medium text-[18px]">{content}</p>)}
                </div>
            ));

            return (
                <div>
                    <textarea className="w-full p-3 border rounded-md focus:ring-2 focus:ring-green-400 transition text-lg" rows="3" placeholder={placeholder} value={value} onChange={onChange} />
                    <button onClick={checkSentence} disabled={isLoading} className="mt-3 flex items-center justify-center gap-2 bg-green-200 text-gray-900 py-2 px-4 rounded-md transition-colors hover:bg-green-300 disabled:opacity-50 disabled:cursor-wait font-semibold text-[14px]">
                        {isLoading ? <Spinner className="w-5 h-5" /> : 'âœ¨'} {isLoading ? 'í”¼ë“œë°± ìƒì„± ì¤‘...' : 'AIì—ê²Œ í”¼ë“œë°± ë°›ê¸°'}
                    </button>
                    {error && <p className="mt-2 text-sm text-red-600">{error}</p>}
                    {feedback && (
                        <div className="mt-4 p-4 bg-green-50 border-l-4 border-green-100 rounded-r-lg space-y-4">
                            {!feedback.is_relevant && ( <div><p className="font-bold text-red-800 flex items-center gap-2 text-lg">{feedback.relevance_feedback_kor}</p><p className="text-gray-600 italic">{feedback.relevance_feedback_eng}</p></div> )}
                            {feedback.is_relevant && feedback.is_correct && ( <div><p className="font-bold text-green-800 flex items-center gap-2 text-lg"><ThumbsUp className="w-5 h-5"/> {feedback.feedback_message_kor}</p><p className="text-gray-600 italic">{feedback.feedback_message_eng}</p></div> )}
                            {feedback.is_relevant && !feedback.is_correct && (<>
                                {feedback.corrected_sentence && ( <div><p className="text-gray-800 font-bold text-[17px]">âœ¨ ìˆ˜ì •ëœ ë¬¸ì¥:</p><p className="text-gray-700 font-medium text-[18px]">{feedback.corrected_sentence}</p></div> )}
                                {(feedback.explanation_kor || feedback.explanation_eng) && ( <div><p className="text-gray-800 font-bold text-[17px]">ì„¤ëª…:</p>{feedback.explanation_kor && <p className="text-gray-600 text-[16px]">{feedback.explanation_kor}</p>}{feedback.explanation_eng && <p className="text-gray-500 italic mt-1 text-[15px]">{feedback.explanation_eng}</p>}</div> )}
                            </>)}
                            {feedback.alternative_expressions && feedback.alternative_expressions.length > 0 && renderFeedbackSection('ğŸ’¡ ë‹¤ë¥¸ í‘œí˜„:', feedback.alternative_expressions)}
                        </div>
                    )}
                </div>
            );
        };

        const DiscussionSection = ({ questions }) => {
            const { useState } = React;
            const [translationsVisible, setTranslationsVisible] = useState({});
            const [userQuestionAnswers, setUserQuestionAnswers] = useState({});
            const toggleTranslation = (id) => { setTranslationsVisible(prev => ({ ...prev, [id]: !prev[id] })); };

            return (
                <div className="space-y-10">
                    {questions.map((q) => (
                        <div key={q.num} className="p-6 border rounded-xl bg-white shadow-lg">
                            <p className="text-gray-900 text-xl font-bold">{q.num}. {q.kor}</p>
                            {translationsVisible[`q-${q.num}`] && (<p className="whitespace-pre-wrap text-gray-600 italic mt-1 text-base">{q.eng}</p>)}
                            <button onClick={() => toggleTranslation(`q-${q.num}`)} className="text-xs text-gray-800 bg-gray-200 hover:bg-gray-300 font-bold py-1 px-3 rounded-full transition duration-200 mt-2 mb-6">ë²ˆì—­ (Translation)</button>
                            {q.vocab && q.vocab.length > 0 && (
                                <div className="mt-4 space-y-4">
                                    <h3 className="font-bold text-lg text-gray-800">ğŸ“í•µì‹¬ í‘œí˜„ (Essential phrases)</h3>
                                    {q.vocab.map((v, i) => (
                                        <div key={i} className="pl-4 border-l-2 border-gray-200 py-2">
                                            <p className="font-semibold text-green-700 text-lg">{v.term}: <span className="font-medium text-gray-700 text-base">{v.meaning_eng}</span></p>
                                            <div className="mt-2">
                                                <h4 className="flex items-center gap-2 text-sm font-bold text-gray-600"><span>ğŸ’¬</span> ëŒ€í™” ì†ì—ì„œ ì‚´í´ë³´ê¸° (See it in Context)</h4>
                                                <div className="mt-1 p-3 bg-gray-100 rounded-lg">
                                                    <p className="text-gray-800">"{v.context}"</p>
                                                    {translationsVisible[`q-${q.num}-context-${i}`] && (<p className="text-gray-600 italic text-sm mt-1">{v.context_eng}</p>)}
                                                    <button onClick={() => toggleTranslation(`q-${q.num}-context-${i}`)} className="text-xs bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-1 px-2 rounded-full transition duration-200 mt-2">ë²ˆì—­ (Translation)</button>
                                                </div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                            <div className="mt-6">
                                <h3 className="font-bold text-lg text-gray-800 mb-2">í•µì‹¬ í‘œí˜„ì„ ì‚¬ìš©í•´ì„œ ì§ˆë¬¸ì— ëŒ€ë‹µí•´ ë³´ì„¸ìš”.</h3>
                                <SentenceChecker
                                    value={userQuestionAnswers[`q-${q.num}`] || ''}
                                    onChange={(e) => setUserQuestionAnswers(prev => ({...prev, [`q-${q.num}`]: e.target.value}))}
                                    placeholder="ì—¬ê¸°ì— ë‹µë³€ì„ ì…ë ¥í•˜ì„¸ìš” (Type your response here)"
                                    question={q.kor}
                                />
                            </div>
                        </div>
                    ))}
                </div>
            );
        };

        const Tabs = ({ tabs }) => {
            const { useState } = React;
            const [activeTab, setActiveTab] = useState(0);
            return (
                <div>
                    <div className="border-b border-gray-200 no-print">
                        <nav className="-mb-px flex space-x-6" aria-label="Tabs">
                            {tabs.map((tab, index) => (
                                <button
                                    key={tab.name} onClick={() => setActiveTab(index)}
                                    className={`${ index === activeTab ? 'border-green-500 text-green-600' : 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300'} whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm sm:text-base transition-colors flex items-center gap-2`}
                                >{tab.icon} {tab.name}</button>
                            ))}
                        </nav>
                    </div>
                    <div className="pt-10">{tabs[activeTab].content}</div>
                </div>
            );
        };

        // --- ë©”ì¸ App ì»´í¬ë„ŒíŠ¸ ---
        const App = () => {
            const { useState, useEffect, useMemo } = React;
            const [containerWidth, setContainerWidth] = useState('30cm');
            const [layoutMode, setLayoutMode] = useState('large');

            useEffect(() => {
                const handleResize = () => {
                    const heightInPx = window.innerHeight; const widthInPx = window.innerWidth;
                    const isMobileDevice = /Mobi|Android/i.test(navigator.userAgent);
                    const isTabletDevice = /iPad|Android(?!.*Mobi)/i.test(navigator.userAgent);
                    const isPortrait = window.matchMedia("(orientation: portrait)").matches;
                    let newMode = 'large'; let newContainerWidth = '30cm';

                    if ((isMobileDevice || isTabletDevice) && isPortrait) { newMode = 'mobile'; newContainerWidth = '100%'; }
                    else {
                        if (heightInPx < 832) { newMode = 'split'; newContainerWidth = '100%'; }
                        else if (heightInPx < 907) { newMode = 'small'; newContainerWidth = '22cm'; }
                        else if (heightInPx < 983) { newMode = 'medium'; newContainerWidth = '24cm'; }
                        else { newMode = 'large'; newContainerWidth = '30cm'; }
                    }
                    setContainerWidth(newContainerWidth); setLayoutMode(newMode); document.body.dataset.layoutMode = newMode;
                    const baseWidthPx = 30 * 37.795; let effectiveWidthPx;
                    if (newContainerWidth === '100%') { effectiveWidthPx = widthInPx; }
                    else { const cmValue = parseFloat(newContainerWidth); effectiveWidthPx = cmValue * 37.795; }
                    if (newMode !== 'large') { const scale = Math.min(1.0, effectiveWidthPx / baseWidthPx); const finalScale = Math.max(0.8, scale); document.documentElement.style.fontSize = `${16 * finalScale}px`; }
                    else { document.documentElement.style.fontSize = '16px'; }
                };
                window.addEventListener('resize', handleResize); handleResize();
                return () => window.removeEventListener('resize', handleResize);
            }, []);

            const { scriptContent, vocabAndGrammarList, sentences, discussionQuestions } = useMemo(() => {
                // Data structures remain multi-line for readability
                const scriptContent = [
                    { id: 's1', speaker: 'ìŠ¤ë¸ŒìŠ¤ë‰´ìŠ¤', kor: 'ìš”ì¦˜ ë¯¸êµ­ ì‚¬ëŒë“¤ì€ ìˆ  ëŒ€ì‹  ë§ˆì‹œëŠ” ê²Œ ìˆì—ˆìœ¼ë‹ˆ, ë°”ë¡œ "ëŒ€ë§ˆ ìŒë£Œ"ë¼ê³  í•©ë‹ˆë‹¤.', time: [0, 4], eng: "" },
                    { id: 's2', speaker: 'ìŠ¤ë¸ŒìŠ¤ë‰´ìŠ¤', kor: 'í˜„ì¬ "ìˆ ì„ ë§ˆì‹ ë‹¤"ë¼ê³  ë‹µí•œ ë¯¸êµ­ ì„±ì¸ì´ ì—­ëŒ€ ìµœì €ì¹˜ë¥¼ ê¸°ë¡í•  ì •ë„.', time: [4, 9], eng: "" },
                    { id: 's3', speaker: 'ìŠ¤ë¸ŒìŠ¤ë‰´ìŠ¤', kor: 'ëŒ€ë§ˆ ìŒë£Œë€ ëŒ€ë§ˆì´ˆì˜ ì„±ë¶„ ì¤‘ THCë¥¼ ì²¨ê°€í•˜ì—¬ ë§Œë“  ìŒë£Œë¥¼ ì˜ë¯¸í•˜ëŠ”ë°ìš”.', time: [9, 14], eng: "" },
                    { id: 's4', speaker: 'ìŠ¤ë¸ŒìŠ¤ë‰´ìŠ¤', kor: 'ì´ëŸ° ëŒ€ë§ˆ ìŒë£Œ ì‹œì¥ì´ ë¯¸êµ­ì—ì„œ ì—„ì²­ë‚˜ê²Œ ì»¤ì§€ê³  ìˆê³ ,', time: [14, 18], eng: "" },
                    { id: 's5', speaker: 'ìŠ¤ë¸ŒìŠ¤ë‰´ìŠ¤', kor: 'ì—¬ëŸ¬ ë¸Œëœë“œì˜ ëŒ€ë§ˆ ìŒë£Œë¥¼ ë§ˆì…” ë³¼ ìˆ˜ ìˆëŠ” ì¶•ì œê°€ ì—´ë¦¬ê¸°ë„ í•˜ê³ ,', time: [18, 22], eng: "" },
                    { id: 's6', speaker: 'ìŠ¤ë¸ŒìŠ¤ë‰´ìŠ¤', kor: 'ëŒ€ë§ˆ ìŒë£Œë¥¼ ë ˆìŠ¤í† ë‘ê³¼ ì˜¨ë¼ì¸ì—ì„œë„ ì‰½ê²Œ êµ¬ë§¤í•  ìˆ˜ ìˆë‹¤ëŠ”ë°.', time: [22, 25], eng: "" },
                    { id: 's7', speaker: 'ìŠ¤ë¸ŒìŠ¤ë‰´ìŠ¤', kor: 'ê°€ì¥ í° ì´ìœ ëŠ” ìˆ ì„ ëŒ€í•˜ëŠ” MZì„¸ëŒ€ì˜ íƒœë„ê°€ ë³€í–ˆê¸° ë•Œë¬¸ì´ë¼ëŠ”ë°ìš”.', time: [25, 29], eng: "" },
                    { id: 's8', speaker: 'ìŠ¤ë¸ŒìŠ¤ë‰´ìŠ¤', kor: 'ì‹¤ì œë¡œ ë¯¸êµ­ì˜ 18ì„¸ì—ì„œ 34ì„¸ ìŒì£¼ìœ¨ ë³€í™”ê°€ ê°€ì¥ í¬ê¸°ë„ í•œë°,', time: [29, 34], eng: "" },
                    { id: 's9', speaker: 'ìŠ¤ë¸ŒìŠ¤ë‰´ìŠ¤', kor: 'ë¯¸êµ­ë¿ë§Œ ì•„ë‹ˆë¼ ì „ ì„¸ê³„ì ìœ¼ë¡œ ê±´ê°•ì„ ì¤‘ìš”í•˜ê²Œ ìƒê°í•˜ëŠ” ê²Œ íŠ¸ë Œë“œê°€ ë˜ë‹ˆ,', time: [34, 39], eng: "" },
                    { id: 's10', speaker: 'ìŠ¤ë¸ŒìŠ¤ë‰´ìŠ¤', kor: 'ìˆ ì„ ë©€ë¦¬í•˜ëŠ” ë§ˆìŒê¹Œì§€ ì´ì–´ì§€ê²Œ ëœ ê²ƒ.', time: [39, 41], eng: "" },
                    { id: 's11', speaker: 'ìŠ¤ë¸ŒìŠ¤ë‰´ìŠ¤', kor: '"ìˆ ì´ ê±´ê°•ì— ì•ˆ ì¢‹ìœ¼ë‹ˆê¹Œ ìˆ  ëŒ€ì‹  ëŒ€ë§ˆ ìŒë£Œë¥¼ ë§ˆì‹œì."', time: [41, 45], eng: "" },
                    { id: 's12', speaker: 'ìŠ¤ë¸ŒìŠ¤ë‰´ìŠ¤', kor: 'ì´ê²Œ ëŒ€ì²´ ì–´ë–»ê²Œ ë‚˜ì˜¨ ìƒê°ì´ì£ ?', time: [45, 48], eng: "" },
                    { id: 's13', speaker: 'í™”ì 2', kor: 'ìˆ ì€ ë„ˆë¬´ ì—­ì‚¬ê°€ ê¹Šì–ì•„ìš”.', time: [48, 49], eng: "" },
                    { id: 's14', speaker: 'í™”ì 2', kor: 'ê±´ê°•ì— í•´ë¡­ë‹¤ëŠ” ê²Œ ì´ì œ ì˜í•™ì´ ë°œë‹¬ì„ í•˜ë©´ì„œ', time: [49, 53], eng: "" },
                    { id: 's15', speaker: 'í™”ì 2', kor: 'ê°„ì— í•´ë¡­ê³  ìˆ™ì·¨ê°€ ìˆê³  ì´ëŸ° ê±¸ ì•Œê²Œ ëœ ê±°ê³ ,', time: [53, 57], eng: "" },
                    { id: 's16', speaker: 'í™”ì 2', kor: 'ëŒ€ë§ˆëŠ” ì•„ì§ì€ ìš°ìš¸ì¦ ì•½ìœ¼ë¡œë„ ì¹˜ë£Œë¥¼ í•˜ëŠ” ê±°ê³ ,', time: [57, 61], eng: "" },
                    { id: 's17', speaker: 'í™”ì 2', kor: 'ì •ì‹  ì•ˆì •ì— ë„ì›€ì´ ë˜ê³  ì´ëŸ° ì–˜ê¸°ë„ ë§ë‹¨ ë§ì´ì—ìš”.', time: [61, 65], eng: "" } // 1:01 is 61 seconds. Added 4 seconds for line duration.
                ];
                const vocabAndGrammarList = [
    {
        term: 'ë§ˆì‹œëŠ” ê²Œ ìˆì—ˆìœ¼ë‹ˆ',
        mainDef: 'There was something they drink (introducing new information)',
        examples: [
            { kor: "ìš”ì¦˜ ë¯¸êµ­ ì‚¬ëŒë“¤ì€ ìˆ  ëŒ€ì‹  ë§ˆì‹œëŠ” ê²Œ ìˆì—ˆìœ¼ë‹ˆ, ë°”ë¡œ 'ëŒ€ë§ˆ ìŒë£Œ'ë¼ê³  í•©ë‹ˆë‹¤.", eng: "These days, Americans have something they drink instead of alcohol, and it's called 'cannabis beverages'." }
        ],
        subDefs: [
            { subTerm: 'ë§ˆì‹œëŠ” ê²Œ', subDef: 'Something to drink, the thing that (someone) drinks - nominalizer' },
            { subTerm: 'ìœ¼ë‹ˆ', subDef: 'Since, because (causal conjunction introducing reason or new information)' }
        ]
    },
    {
        term: 'ëŒ€ë§ˆ ìŒë£Œ',
        mainDef: 'Cannabis beverage, marijuana drink',
        examples: [
            { kor: "ë°”ë¡œ 'ëŒ€ë§ˆ ìŒë£Œ'ë¼ê³  í•©ë‹ˆë‹¤.", eng: "It's called 'cannabis beverages'." }
        ],
        subDefs: [
            { subTerm: 'ëŒ€ë§ˆ', subDef: 'Cannabis, marijuana, hemp' },
            { subTerm: 'ìŒë£Œ', subDef: 'Beverage, drink' }
        ]
    },
    {
        term: 'ë¼ê³  í•˜ë‹¤',
        mainDef: 'To call, to be called, to say (quotative particle + verb)',
        examples: [
            { kor: "ë°”ë¡œ 'ëŒ€ë§ˆ ìŒë£Œ'ë¼ê³  í•©ë‹ˆë‹¤.", eng: "It's called 'cannabis beverages'." }
        ],
        subDefs: []
    },
    {
        term: '"ìˆ ì„ ë§ˆì‹ ë‹¤"ë¼ê³  ë‹µí•œ ë¯¸êµ­ ì„±ì¸',
        mainDef: 'American adults who answered "I drink alcohol"',
        examples: [
            { kor: "í˜„ì¬ 'ìˆ ì„ ë§ˆì‹ ë‹¤'ë¼ê³  ë‹µí•œ ë¯¸êµ­ ì„±ì¸ì´ ì—­ëŒ€ ìµœì €ì¹˜ë¥¼ ê¸°ë¡í•  ì •ë„.", eng: "Currently, American adults who answer 'I drink alcohol' are at an all-time low." }
        ],
        subDefs: [
            { subTerm: 'ë¼ê³  ë‹µí•˜ë‹¤', subDef: 'To answer/respond that (quotative + verb)' },
            { subTerm: 'ã„´', subDef: 'Modifier ending for past/completed action describing noun' },
            { subTerm: 'ì„±ì¸', subDef: 'Adult, grown-up person' }
        ]
    },
    {
        term: 'ì—­ëŒ€ ìµœì €ì¹˜ë¥¼ ê¸°ë¡í•  ì •ë„',
        mainDef: 'To the extent of recording an all-time low',
        examples: [
            { kor: "ì—­ëŒ€ ìµœì €ì¹˜ë¥¼ ê¸°ë¡í•  ì •ë„.", eng: "To the extent of recording an all-time low." }
        ],
        subDefs: [
            { subTerm: 'ì—­ëŒ€', subDef: 'All-time, throughout history, over the years' },
            { subTerm: 'ìµœì €ì¹˜', subDef: 'Lowest point, minimum level, all-time low' },
            { subTerm: 'ê¸°ë¡í•˜ë‹¤', subDef: 'To record, to register, to mark' },
            { subTerm: 'ã„¹ ì •ë„', subDef: 'To the extent that, so much that (degree/extent)' }
        ]
    },
    {
        term: 'ëŒ€ë§ˆì´ˆì˜ ì„±ë¶„ ì¤‘',
        mainDef: 'Among the components of cannabis',
        examples: [
            { kor: "ëŒ€ë§ˆ ìŒë£Œë€ ëŒ€ë§ˆì´ˆì˜ ì„±ë¶„ ì¤‘ THCë¥¼ ì²¨ê°€í•˜ì—¬ ë§Œë“  ìŒë£Œë¥¼ ì˜ë¯¸í•˜ëŠ”ë°ìš”.", eng: "Cannabis beverages refer to drinks made by adding THC, one of the components of cannabis." }
        ],
        subDefs: [
            { subTerm: 'ëŒ€ë§ˆì´ˆ', subDef: 'Cannabis, marijuana plant' },
            { subTerm: 'ì„±ë¶„', subDef: 'Component, ingredient, element' },
            { subTerm: 'ì¤‘', subDef: 'Among, out of, from among' }
        ]
    },
    {
        term: 'ì²¨ê°€í•˜ì—¬ ë§Œë“  ìŒë£Œ',
        mainDef: 'Beverages made by adding (ingredient)',
        examples: [
            { kor: "THCë¥¼ ì²¨ê°€í•˜ì—¬ ë§Œë“  ìŒë£Œë¥¼ ì˜ë¯¸í•˜ëŠ”ë°ìš”.", eng: "It refers to drinks made by adding THC." }
        ],
        subDefs: [
            { subTerm: 'ì²¨ê°€í•˜ë‹¤', subDef: 'To add, to supplement, to put in (ingredient)' },
            { subTerm: 'ì—¬', subDef: 'Connective form of -í•˜ì—¬ (by doing, through doing)' },
            { subTerm: 'ã„´', subDef: 'Modifier ending for past/completed action describing noun' },
            { subTerm: 'ìŒë£Œ', subDef: 'Beverage, drink' }
        ]
    },
    {
        term: 'ì˜ë¯¸í•˜ëŠ”ë°ìš”',
        mainDef: 'It means/refers to (polite explanation)',
        examples: [
            { kor: "ëŒ€ë§ˆ ìŒë£Œë€ ëŒ€ë§ˆì´ˆì˜ ì„±ë¶„ ì¤‘ THCë¥¼ ì²¨ê°€í•˜ì—¬ ë§Œë“  ìŒë£Œë¥¼ ì˜ë¯¸í•˜ëŠ”ë°ìš”.", eng: "Cannabis beverages refer to drinks made by adding THC, one of the components of cannabis." }
        ],
        subDefs: [
            { subTerm: 'ì˜ë¯¸í•˜ë‹¤', subDef: 'To mean, to signify, to refer to' },
            { subTerm: 'ëŠ”ë°ìš”', subDef: 'You see, and (polite background information or explanation)' }
        ]
    },
    {
        term: 'ì—„ì²­ë‚˜ê²Œ ì»¤ì§€ê³  ìˆê³ ',
        mainDef: 'Is growing tremendously, and',
        examples: [
            { kor: "ì´ëŸ° ëŒ€ë§ˆ ìŒë£Œ ì‹œì¥ì´ ë¯¸êµ­ì—ì„œ ì—„ì²­ë‚˜ê²Œ ì»¤ì§€ê³  ìˆê³ ,", eng: "The cannabis beverage market in America is growing tremendously, and" }
        ],
        subDefs: [
            { subTerm: 'ì—„ì²­ë‚˜ê²Œ', subDef: 'Tremendously, hugely, enormously' },
            { subTerm: 'ì»¤ì§€ë‹¤', subDef: 'To grow, to get bigger, to expand' },
            { subTerm: 'ê³  ìˆë‹¤', subDef: 'Is doing, in progress (progressive aspect)' }
        ]
    },
    {
        term: 'ë§ˆì…” ë³¼ ìˆ˜ ìˆëŠ” ì¶•ì œê°€ ì—´ë¦¬ê¸°ë„ í•˜ê³ ',
        mainDef: 'Festivals where you can try drinking (them) are also held, and',
        examples: [
            { kor: "ì—¬ëŸ¬ ë¸Œëœë“œì˜ ëŒ€ë§ˆ ìŒë£Œë¥¼ ë§ˆì…” ë³¼ ìˆ˜ ìˆëŠ” ì¶•ì œê°€ ì—´ë¦¬ê¸°ë„ í•˜ê³ ,", eng: "Festivals where you can try various brands of cannabis beverages are also held, and" }
        ],
        subDefs: [
            { subTerm: 'ì•„/ì–´ ë³¼ ìˆ˜ ìˆë‹¤', subDef: 'Can try doing, able to try (experiential + possibility)' },
            { subTerm: 'ëŠ”', subDef: 'Modifier ending for present/ongoing action describing noun' },
            { subTerm: 'ì¶•ì œê°€ ì—´ë¦¬ë‹¤', subDef: 'A festival is held, festival takes place' },
            { subTerm: 'ê¸°ë„ í•˜ë‹¤', subDef: 'Also do, even do (adding information)' }
        ]
    },
    {
        term: 'ì‰½ê²Œ êµ¬ë§¤í•  ìˆ˜ ìˆë‹¤ëŠ”ë°',
        mainDef: 'I hear you can easily purchase (it)',
        examples: [
            { kor: "ëŒ€ë§ˆ ìŒë£Œë¥¼ ë ˆìŠ¤í† ë‘ê³¼ ì˜¨ë¼ì¸ì—ì„œë„ ì‰½ê²Œ êµ¬ë§¤í•  ìˆ˜ ìˆë‹¤ëŠ”ë°.", eng: "I hear you can easily purchase cannabis beverages at restaurants and online too." }
        ],
        subDefs: [
            { subTerm: 'ì‰½ê²Œ', subDef: 'Easily, simply, without difficulty' },
            { subTerm: 'êµ¬ë§¤í•˜ë‹¤', subDef: 'To purchase, to buy' },
            { subTerm: 'ëŠ”ë°', subDef: 'I hear that, they say (hearsay or providing background)' }
        ]
    },
    {
        term: 'ì´ìœ ',
        mainDef: 'Reason, cause',
        examples: [
            { kor: "ê°€ì¥ í° ì´ìœ ëŠ” ìˆ ì„ ëŒ€í•˜ëŠ” MZì„¸ëŒ€ì˜ íƒœë„ê°€ ë³€í–ˆê¸° ë•Œë¬¸ì´ë¼ëŠ”ë°ìš”.", eng: "The biggest reason is that MZ generation's attitude toward alcohol has changed." }
        ],
        subDefs: []
    },
    {
        term: 'ìˆ ì„ ëŒ€í•˜ëŠ” MZì„¸ëŒ€ì˜ íƒœë„ê°€ ë³€í–ˆê¸° ë•Œë¬¸ì´ë¼ëŠ”ë°ìš”',
        mainDef: 'It\'s because MZ generation\'s attitude toward alcohol has changed, I hear',
        examples: [
            { kor: "ê°€ì¥ í° ì´ìœ ëŠ” ìˆ ì„ ëŒ€í•˜ëŠ” MZì„¸ëŒ€ì˜ íƒœë„ê°€ ë³€í–ˆê¸° ë•Œë¬¸ì´ë¼ëŠ”ë°ìš”.", eng: "The biggest reason is that MZ generation's attitude toward alcohol has changed." }
        ],
        subDefs: [
            { subTerm: 'ëŒ€í•˜ëŠ” íƒœë„', subDef: 'Attitude toward (something), way of treating/dealing with' },
            { subTerm: 'MZì„¸ëŒ€', subDef: 'MZ generation (Millennials + Gen Z)' },
            { subTerm: 'ë³€í•˜ë‹¤', subDef: 'To change, to transform, to shift' },
            { subTerm: 'ê¸° ë•Œë¬¸ì´ë¼ëŠ”ë°ìš”', subDef: 'I hear it\'s because (hearsay + causal reason)' }
        ]
    },
    {
        term: 'ì‹¤ì œë¡œ',
        mainDef: 'Actually, in reality, in fact',
        examples: [
            { kor: "ì‹¤ì œë¡œ ë¯¸êµ­ì˜ 18ì„¸ì—ì„œ 34ì„¸ ìŒì£¼ìœ¨ ë³€í™”ê°€ ê°€ì¥ í¬ê¸°ë„ í•œë°,", eng: "In fact, the change in drinking rates among 18-34 year olds in America is also the largest," }
        ],
        subDefs: []
    },
    {
        term: 'ìŒì£¼ìœ¨ ë³€í™”ê°€ ê°€ì¥ í¬ê¸°ë„ í•œë°',
        mainDef: 'The change in drinking rate is also the largest, and',
        examples: [
            { kor: "ì‹¤ì œë¡œ ë¯¸êµ­ì˜ 18ì„¸ì—ì„œ 34ì„¸ ìŒì£¼ìœ¨ ë³€í™”ê°€ ê°€ì¥ í¬ê¸°ë„ í•œë°,", eng: "In fact, the change in drinking rates among 18-34 year olds in America is also the largest," }
        ],
        subDefs: [
            { subTerm: 'ìŒì£¼ìœ¨', subDef: 'Drinking rate, alcohol consumption rate' },
            { subTerm: 'ë³€í™”', subDef: 'Change, transformation, shift' },
            { subTerm: 'ê¸°ë„ í•˜ë‹¤', subDef: 'Also is/does (adding related information)' },
            { subTerm: 'ã„´ë°', subDef: 'And, but (softer connective providing background)' }
        ]
    },
    {
        term: 'ë¯¸êµ­ë¿ë§Œ ì•„ë‹ˆë¼ ì „ ì„¸ê³„ì ìœ¼ë¡œ',
        mainDef: 'Not only in America but globally/worldwide',
        examples: [
            { kor: "ë¯¸êµ­ë¿ë§Œ ì•„ë‹ˆë¼ ì „ ì„¸ê³„ì ìœ¼ë¡œ ê±´ê°•ì„ ì¤‘ìš”í•˜ê²Œ ìƒê°í•˜ëŠ” ê²Œ íŠ¸ë Œë“œê°€ ë˜ë‹ˆ,", eng: "Not only in America but globally, thinking of health as important has become a trend, so" }
        ],
        subDefs: [
            { subTerm: 'ë¿ë§Œ ì•„ë‹ˆë¼', subDef: 'Not only... but also (expansion particle)' },
            { subTerm: 'ì „ ì„¸ê³„ì ìœ¼ë¡œ', subDef: 'Globally, worldwide, internationally' }
        ]
    },
    {
        term: 'ê±´ê°•ì„ ì¤‘ìš”í•˜ê²Œ ìƒê°í•˜ëŠ” ê²Œ',
        mainDef: 'Thinking of health as important (nominalizer)',
        examples: [
            { kor: "ê±´ê°•ì„ ì¤‘ìš”í•˜ê²Œ ìƒê°í•˜ëŠ” ê²Œ íŠ¸ë Œë“œê°€ ë˜ë‹ˆ,", eng: "Thinking of health as important has become a trend, so" }
        ],
        subDefs: [
            { subTerm: 'ê±´ê°•', subDef: 'Health, wellness' },
            { subTerm: 'ëŠ” ê²Œ', subDef: 'The thing/act of (doing) - nominalizer for actions' }
        ]
    },
    {
        term: 'íŠ¸ë Œë“œê°€ ë˜ë‹ˆ',
        mainDef: 'Since it became a trend, as it becomes trendy',
        examples: [
            { kor: "ê±´ê°•ì„ ì¤‘ìš”í•˜ê²Œ ìƒê°í•˜ëŠ” ê²Œ íŠ¸ë Œë“œê°€ ë˜ë‹ˆ,", eng: "Since thinking of health as important has become a trend," }
        ],
        subDefs: [
            { subTerm: 'íŠ¸ë Œë“œ', subDef: 'Trend, fashion, current style' },
            { subTerm: 'ë‹ˆ', subDef: 'Since, so, because (causal reason)' }
        ]
    },
    {
        term: 'ìˆ ì„ ë©€ë¦¬í•˜ëŠ” ë§ˆìŒê¹Œì§€ ì´ì–´ì§€ê²Œ ëœ ê²ƒ',
        mainDef: 'It has led even to the mindset of avoiding alcohol',
        examples: [
            { kor: "ìˆ ì„ ë©€ë¦¬í•˜ëŠ” ë§ˆìŒê¹Œì§€ ì´ì–´ì§€ê²Œ ëœ ê²ƒ.", eng: "It has led even to the mindset of avoiding alcohol." }
        ],
        subDefs: [
            { subTerm: 'ë©€ë¦¬í•˜ë‹¤', subDef: 'To avoid, to stay away from, to distance oneself' },
            { subTerm: 'ëŠ”', subDef: 'Modifier ending for present/ongoing action describing noun' },
            { subTerm: 'ë§ˆìŒì´ ì´ì–´ì§€ë‹¤', subDef: 'Mindset/feeling extends to, leads to (mental state)' },
            { subTerm: 'ëŠ” ê²ƒ', subDef: 'The thing/fact that (nominalizing completed situation)' }
        ]
    },
    {
        term: 'ìˆ ì´ ê±´ê°•ì— ì•ˆ ì¢‹ìœ¼ë‹ˆê¹Œ',
        mainDef: 'Since alcohol is bad for health',
        examples: [
            { kor: "'ìˆ ì´ ê±´ê°•ì— ì•ˆ ì¢‹ìœ¼ë‹ˆê¹Œ ìˆ  ëŒ€ì‹  ëŒ€ë§ˆ ìŒë£Œë¥¼ ë§ˆì‹œì.'", eng: "'Since alcohol is bad for health, let's drink cannabis beverages instead of alcohol.'" }
        ],
        subDefs: [
            { subTerm: 'ê±´ê°•', subDef: 'Health, wellness' },
            { subTerm: 'ë‹ˆê¹Œ', subDef: 'Since, because (causal reason, often for justification)' }
        ]
    },
    {
        term: 'ì´ê²Œ ëŒ€ì²´ ì–´ë–»ê²Œ ë‚˜ì˜¨ ìƒê°ì´ì£ ?',
        mainDef: 'How on earth did this idea come about? (rhetorical disbelief)',
        examples: [
            { kor: "ì´ê²Œ ëŒ€ì²´ ì–´ë–»ê²Œ ë‚˜ì˜¨ ìƒê°ì´ì£ ?", eng: "How on earth did this idea come about?" }
        ],
        subDefs: [
            { subTerm: 'ëŒ€ì²´ ì–´ë–»ê²Œ', subDef: 'How on earth, how in the world (emphasizing disbelief)' },
            { subTerm: 'ìƒê°ì´ ë‚˜ì˜¤ë‹¤', subDef: 'An idea comes out, thought emerges' }
        ]
    },
    {
        term: 'ì—­ì‚¬ê°€ ê¹Šì–ì•„ìš”',
        mainDef: 'It has a deep/long history, you know',
        examples: [
            { kor: "ìˆ ì€ ë„ˆë¬´ ì—­ì‚¬ê°€ ê¹Šì–ì•„ìš”.", eng: "Alcohol has such a long history, you know." }
        ],
        subDefs: [
            { subTerm: 'ì—­ì‚¬', subDef: 'History, historical background' },
            { subTerm: 'ê¹Šë‹¤', subDef: 'To be deep, to be long (for history)' },
            { subTerm: 'ì–ì•„ìš”', subDef: 'You know (asserting known/obvious fact - polite)' }
        ]
    },
    {
        term: 'ê±´ê°•ì— í•´ë¡­ë‹¤ëŠ” ê²Œ',
        mainDef: 'The fact that it\'s harmful to health',
        examples: [
            { kor: "ê±´ê°•ì— í•´ë¡­ë‹¤ëŠ” ê²Œ ì´ì œ ì˜í•™ì´ ë°œë‹¬ì„ í•˜ë©´ì„œ", eng: "The fact that it's harmful to health, now as medicine has developed" }
        ],
        subDefs: [
            { subTerm: 'ê±´ê°•', subDef: 'Health, wellness' },
            { subTerm: 'í•´ë¡­ë‹¤', subDef: 'To be harmful, to be detrimental, to be bad for' },
            { subTerm: 'ëŠ” ê²Œ', subDef: 'The thing/fact that (nominalizing statement)' }
        ]
    },
    {
        term: 'ì˜í•™ì´ ë°œë‹¬ì„ í•˜ë©´ì„œ',
        mainDef: 'As medicine develops/has developed',
        examples: [
            { kor: "ê±´ê°•ì— í•´ë¡­ë‹¤ëŠ” ê²Œ ì´ì œ ì˜í•™ì´ ë°œë‹¬ì„ í•˜ë©´ì„œ", eng: "The fact that it's harmful to health, now as medicine has developed" }
        ],
        subDefs: [
            { subTerm: 'ì˜í•™', subDef: 'Medicine, medical science' },
            { subTerm: 'ë°œë‹¬í•˜ë‹¤', subDef: 'To develop, to advance, to progress' },
            { subTerm: 'ë©´ì„œ', subDef: 'While, as (simultaneous actions or process)' }
        ]
    },
    {
        term: 'ê°„ì— í•´ë¡­ê³  ìˆ™ì·¨ê°€ ìˆê³ ',
        mainDef: 'It\'s harmful to the liver and causes hangovers, and',
        examples: [
            { kor: "ê°„ì— í•´ë¡­ê³  ìˆ™ì·¨ê°€ ìˆê³  ì´ëŸ° ê±¸ ì•Œê²Œ ëœ ê±°ê³ ,", eng: "We came to know things like it's harmful to the liver and causes hangovers," }
        ],
        subDefs: [
            { subTerm: 'ê°„', subDef: 'Liver (organ)' },
            { subTerm: 'í•´ë¡­ë‹¤', subDef: 'To be harmful, to be detrimental' },
            { subTerm: 'ìˆ™ì·¨ê°€ ìˆë‹¤', subDef: 'To have a hangover, hangover exists' }
        ]
    },
    {
        term: 'ì´ëŸ° ê±¸ ì•Œê²Œ ëœ ê±°ê³ ',
        mainDef: 'We came to know these things, and',
        examples: [
            { kor: "ê°„ì— í•´ë¡­ê³  ìˆ™ì·¨ê°€ ìˆê³  ì´ëŸ° ê±¸ ì•Œê²Œ ëœ ê±°ê³ ,", eng: "We came to know things like it's harmful to the liver and causes hangovers," }
        ],
        subDefs: [
            { subTerm: 'ì´ëŸ° ê±¸', subDef: 'These things, things like this (colloquial object)' },
            { subTerm: 'ì•Œê²Œ ë˜ë‹¤', subDef: 'To come to know, to get to know, to become aware' },
            { subTerm: 'ã„´ ê±°ê³ ', subDef: 'It is that..., and (colloquial explanatory connective)' }
        ]
    },
    {
        term: 'ìš°ìš¸ì¦ ì•½ìœ¼ë¡œë„ ì¹˜ë£Œë¥¼ í•˜ëŠ” ê±°ê³ ',
        mainDef: 'It\'s also used as medicine to treat depression, and',
        examples: [
            { kor: "ëŒ€ë§ˆëŠ” ì•„ì§ì€ ìš°ìš¸ì¦ ì•½ìœ¼ë¡œë„ ì¹˜ë£Œë¥¼ í•˜ëŠ” ê±°ê³ ,", eng: "Cannabis is still being used as medicine to treat depression, and" }
        ],
        subDefs: [
            { subTerm: 'ìš°ìš¸ì¦ ì•½', subDef: 'Depression medication, antidepressant' },
            { subTerm: 'ìœ¼ë¡œ ì¹˜ë£Œí•˜ë‹¤', subDef: 'To treat with, to cure using (instrumental particle + verb)' },
            { subTerm: 'ëŠ” ê±°ê³ ', subDef: 'It is that..., and (colloquial explanatory connective)' }
        ]
    },
    {
        term: 'ì •ì‹  ì•ˆì •ì— ë„ì›€ì´ ë˜ê³ ',
        mainDef: 'It helps with mental stability, and',
        examples: [
            { kor: "ì •ì‹  ì•ˆì •ì— ë„ì›€ì´ ë˜ê³  ì´ëŸ° ì–˜ê¸°ë„ ë§ë‹¨ ë§ì´ì—ìš”.", eng: "There are many stories about it helping with mental stability and such." }
        ],
        subDefs: [
            { subTerm: 'ì •ì‹  ì•ˆì •', subDef: 'Mental stability, psychological calm' },
            { subTerm: 'ë„ì›€ì´ ë˜ë‹¤', subDef: 'To be helpful, to help with, to benefit' }
        ]
    },
    {
        term: 'ì´ëŸ° ì–˜ê¸°ë„ ë§ë‹¨ ë§ì´ì—ìš”',
        mainDef: 'There are many stories like this, you see (emphasizing point)',
        examples: [
            { kor: "ì •ì‹  ì•ˆì •ì— ë„ì›€ì´ ë˜ê³  ì´ëŸ° ì–˜ê¸°ë„ ë§ë‹¨ ë§ì´ì—ìš”.", eng: "There are many stories about it helping with mental stability and such." }
        ],
        subDefs: [
            { subTerm: 'ì´ëŸ° ì–˜ê¸°', subDef: 'Stories/talk like this, this kind of narrative' },
            { subTerm: 'ã„´ ë§ì´ì—ìš”', subDef: 'I\'m saying that, you see (emphatic explanation)' }
        ]
    }
];
                const sentences = [
                    // Previous content removed as it was for a different topic.
                ];
                const discussionQuestions = [
                    // Previous content removed as it was for a different topic.
                ];
                return { scriptContent, vocabAndGrammarList, sentences, discussionQuestions };
            }, []);

            const { vocabMap, highlightData } = useMemo(() => {
                const vocabMap = new Map(vocabAndGrammarList.map(item => [item.term, item]));
                const wordMap = new Map();
                vocabAndGrammarList.forEach(item => wordMap.set(item.term, item));
                const allWords = Array.from(wordMap.keys()).sort((a, b) => b.length - a.length);
                const regexParts = [];
                allWords.forEach(word => {
                    const item = wordMap.get(word);
                    if (item.variants) item.variants.forEach(v => regexParts.push(v.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')));
                    let processed = word.replace(/[.*+?^${}()|[\]\\]/g, '\\$&').replace(/\s+/g, '\\s*');
                    if (word.endsWith('ë‹¤')) {
                        const parts = word.split(' ');
                        const lastPart = parts[parts.length - 1];
                        if (lastPart.endsWith('ë‹¤')) {
                            const stem = lastPart.slice(0, -1).replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
                            const firstParts = parts.slice(0, -1).map(p => p.replace(/[.*+?^${}()|[\]\D]/g, '\\$&'));
                            regexParts.push([...firstParts, `${stem}[ê°€-í£]*`].join('\\s*'));
                        } else { regexParts.push(`${processed.slice(0, -1)}[ê°€-í£]*`); }
                    } else { regexParts.push(processed); }
                });
                const regexString = [...new Set(regexParts)].sort((a,b) => b.length - a.length).join('|');
                return { vocabMap, highlightData: { regex: new RegExp(`(${regexString})`, 'g'), wordMap, sortedWords: allWords }};
            }, [vocabAndGrammarList]);

            const tabs = useMemo(() => {
                const baseTabs = [
                    { name: 'ëŒ€í™” ìŠ¤í¬ë¦½íŠ¸ (Transcript)', icon: <Video className="w-6 h-6"/>, content: <VideoMaterialsTab scriptContent={scriptContent} vocabAndGrammarList={vocabAndGrammarList} highlightData={highlightData} vocabMap={vocabMap} /> },
                    { name: 'í•µì‹¬ ì–´íœ˜ (Key Vocabulary)', icon: <List className="w-6 h-6"/>, content: (
                        <div>
                            <h2 className="text-3xl font-extrabold text-gray-900 mb-8 flex items-center gap-3"><List className="w-8 h-8 text-green-600"/> í•µì‹¬ ì–´íœ˜ (Key Vocabulary)</h2>
                            <div className="w-full overflow-y-auto" style={{maxHeight: `calc(100vh - 150px)`}}>
                                <div className="border rounded-lg bg-white p-2 shadow-lg">
                                    <div className="space-y-1">{vocabAndGrammarList.map(item => <VocabItem key={item.term} item={item} />)}</div>
                                </div>
                            </div>
                        </div>
                    )},
                    { name: 'ë‚´ìš© í™•ì¸ í€´ì¦ˆ (Comprehension Check-Up)', icon: <BookOpen className="w-6 h-6"/>, content: (
                        <div>
                            <h2 className="text-3xl font-extrabold text-gray-900 mb-8 flex items-center gap-3"><BookOpen className="w-8 h-8 text-green-600"/> ë‚´ìš© í™•ì¸ í€´ì¦ˆ (Comprehension Check-Up)</h2>
                            <ComprehensionQuiz sentences={sentences} />
                        </div>
                    )},
                    { name: 'ìƒê°í•´ ë³´ê¸° (Food For Thought)', icon: <MessageSquare className="w-6 h-6"/>, content: (
                        <div>
                            <h2 className="text-3xl font-extrabold text-gray-900 mb-8 flex items-center gap-3"><MessageSquare className="w-8 h-8 text-green-600"/> ìƒê°í•´ ë³´ê¸° (Food For Thought)</h2>
                            <DiscussionSection questions={discussionQuestions} />
                        </div>
                    ) }
                ];
                return baseTabs;
            }, [layoutMode, scriptContent, vocabAndGrammarList, sentences, discussionQuestions, highlightData, vocabMap]);

            return (
                <div className="bg-gray-50 text-gray-800 p-4 sm:p-6 md:p-8">
                    <div className="mx-auto transition-all duration-300" style={{ maxWidth: containerWidth }}>
                        <header className="text-center mb-12">
                            <h1 className="text-4xl md:text-5xl font-black text-gray-900 mb-2">ì™¼ì†ì¡ì´ì— ëŒ€í•œ ì˜¤í•´ì™€ ì§„ì‹¤</h1>
                            <p className="text-xl text-gray-500" style={{fontFamily: "'Nanum Gothic', sans-serif"}}>Misconceptions and Truths about Left-Handedness</p>
                        </header>
                        <Tabs tabs={tabs} />
                        {layoutMode === 'mobile' && (
                            <div className="pt-10">
                                <h2 className="text-3xl font-extrabold text-gray-900 mb-8 flex items-center gap-3"><List className="w-8 h-8 text-green-600"/> í•µì‹¬ ì–´íœ˜ (Key Vocabulary)</h2>
                                <div className="w-full">
                                    <div className="border rounded-lg bg-white p-2 shadow-lg">
                                        <div className="space-y-1">{vocabAndGrammarList.map(item => <VocabItem key={item.term} item={item} />)}</div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };
    
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

